<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Loading Fix Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1e1e1e;
            color: #cccccc;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #252526;
            padding: 20px;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #16825d; color: white; }
        .error { background: #f14c4c; color: white; }
        .info { background: #0e639c; color: white; }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #2d2d30;
            border-radius: 4px;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #454545;
            border-radius: 4px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔧 UI Loading Fix Verification</h1>
        
        <div class="status info">
            <strong>Test Purpose:</strong> Verify that the ES6 dynamic import issue has been resolved and both UIs can load properly.
        </div>
        
        <h2>Test Results</h2>
        <div class="test-results">
            <h3>Test 1: Enhanced UI Loading</h3>
            <div id="test1-result" class="status info">Running test...</div>
            
            <h3>Test 2: Basic UI Loading</h3>
            <div id="test2-result" class="status info">Running test...</div>
            
            <h3>Test 3: Script Loading Method</h3>
            <div id="test3-result" class="status info">Running test...</div>
        </div>
        
        <h2>Live UI Test</h2>
        <p>The iframe below loads the actual UI to test the fix:</p>
        <iframe src="out/webview/frontend/index.html?debug" id="ui-test-frame"></iframe>
        
        <div class="status info" style="margin-top: 15px;">
            <strong>Expected Behavior:</strong>
            <ul>
                <li>✅ No "Failed to fetch dynamically imported module" errors</li>
                <li>✅ UI loads successfully (either Enhanced or Basic)</li>
                <li>✅ Console shows "initialization complete" message</li>
                <li>✅ VS Code commands can be executed</li>
            </ul>
        </div>
    </div>

    <script>
        // Test 1: Check if enhanced.js can be loaded as regular script
        async function test1() {
            try {
                const testDiv = document.getElementById('test1-result');
                testDiv.textContent = 'Loading enhanced.js as script...';
                
                // Create script element and load enhanced.js
                const script = document.createElement('script');
                script.src = 'out/webview/frontend/js/enhanced.js';
                
                script.onload = () => {
                    if (typeof window.EnhancedApp !== 'undefined') {
                        testDiv.className = 'status success';
                        testDiv.textContent = '✅ Enhanced UI script loaded successfully, EnhancedApp class available';
                    } else {
                        testDiv.className = 'status error';
                        testDiv.textContent = '❌ EnhancedApp class not found after loading';
                    }
                };
                
                script.onerror = (error) => {
                    testDiv.className = 'status error';
                    testDiv.textContent = `❌ Failed to load enhanced.js: ${error.message}`;
                };
                
                document.head.appendChild(script);
            } catch (error) {
                document.getElementById('test1-result').className = 'status error';
                document.getElementById('test1-result').textContent = `❌ Test 1 failed: ${error.message}`;
            }
        }
        
        // Test 2: Check if basic.js can be loaded as regular script
        async function test2() {
            try {
                const testDiv = document.getElementById('test2-result');
                testDiv.textContent = 'Loading basic.js as script...';
                
                // Create script element and load basic.js
                const script = document.createElement('script');
                script.src = 'out/webview/frontend/js/basic.js';
                
                script.onload = () => {
                    if (typeof window.BasicApp !== 'undefined') {
                        testDiv.className = 'status success';
                        testDiv.textContent = '✅ Basic UI script loaded successfully, BasicApp class available';
                    } else {
                        testDiv.className = 'status error';
                        testDiv.textContent = '❌ BasicApp class not found after loading';
                    }
                };
                
                script.onerror = (error) => {
                    testDiv.className = 'status error';
                    testDiv.textContent = `❌ Failed to load basic.js: ${error.message}`;
                };
                
                document.head.appendChild(script);
            } catch (error) {
                document.getElementById('test2-result').className = 'status error';
                document.getElementById('test2-result').textContent = `❌ Test 2 failed: ${error.message}`;
            }
        }
        
        // Test 3: Verify script loading mechanism
        function test3() {
            const testDiv = document.getElementById('test3-result');
            
            // Test the loadScript function from the main HTML
            try {
                // Check if we can create and load a script element
                const testScript = document.createElement('script');
                testScript.textContent = 'window.testScriptLoaded = true;';
                document.head.appendChild(testScript);
                
                if (window.testScriptLoaded) {
                    testDiv.className = 'status success';
                    testDiv.textContent = '✅ Script loading mechanism works correctly';
                } else {
                    testDiv.className = 'status error';
                    testDiv.textContent = '❌ Script loading mechanism failed';
                }
            } catch (error) {
                testDiv.className = 'status error';
                testDiv.textContent = `❌ Test 3 failed: ${error.message}`;
            }
        }
        
        // Run tests
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                test1();
                test2();
                test3();
            }, 500);
        });
        
        // Monitor iframe for errors
        window.addEventListener('message', (event) => {
            console.log('Iframe message:', event.data);
        });
        
        // Check iframe console for errors (if accessible)
        setTimeout(() => {
            try {
                const iframe = document.getElementById('ui-test-frame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                console.log('Iframe loaded:', iframeDoc.readyState);
            } catch (error) {
                console.log('Cannot access iframe content (normal for security)');
            }
        }, 2000);
    </script>
</body>
</html>